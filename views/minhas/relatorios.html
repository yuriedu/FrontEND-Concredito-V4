<div id="propostasPage" style="max-height: 100vh; overflow: auto; position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; max-width: 100vw; overflow-x: hidden;">
  <navbar id="navbar"></navbar>
  <script>$("#navbar").load(`/imports/navbar.html`)</script>

  <div class="flex-direction-column margin-left38" style="width: 92.5vw; display: flex; justify-content: center; margin-left: 6vw; margin-top: 12.5vh;">
    <div class="background-image width40 height15" style="margin-bottom: 0.5vh; width: 65vw; border-radius: 2vh; height: 5vw; margin-inline: 0.6vw; display: flex; flex-direction: row; justify-content: center; align-items: center; padding-inline: 2vw">
      <fieldset title="Coloque o objetivo em porcentagem..." style="padding: 0; margin: 0; border-radius: 0.6vh; width: 19%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Relatorio</legend>
        <select id="relatorio" style="padding:0; margin:0; font-size: 2.5vh; width: 100%; height: 4vh; background: transparent; border: 0">
          <option style="color: black" value="funcionarios">Meu Relatorio</option>
          <option style="color: black" value="empresa">Minha Equipe</option>
        </select>
      </fieldset>
      <fieldset title="Coloque a data minima..." style="padding: 0; margin: 0; border-radius: 0.6vh; width: 15%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Data Inicial</legend>
        <input type="date" id="dateIni" style="padding:0; margin:0; font-size: 2.5vh; width: 100%; height: 4vh; background: transparent; border: 0">
      </fieldset>
      <fieldset title="Coloque a data maxima..." style="padding: 0; margin: 0; border-radius: 0.6vh; width: 15%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Data Final</legend>
        <input type="date" id="dateEnd" style="padding:0; margin:0; font-size: 2.5vh; width: 100%; height: 4vh; background: transparent; border: 0">
      </fieldset>
      <fieldset title="Coloque o objetivo em porcentagem..." style="padding: 0; margin: 0; border-radius: 0.6vh; width: 11%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Objetivo</legend>
        <input onkeyup="changeComissao()" type="text" placeholder="100%" value="100%" id="objetivo" style="padding:0; margin:0; font-size: 2.5vh; width: 100%; height: 4vh; background: transparent; border: 0">
      </fieldset>
      <fieldset title="Sua comissão conforme o objetivo..." style="padding: 0; margin: 0; border-radius: 0.6vh; width: 15%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Comissão</legend>
        <input disabled value="R$ 800,00" id="comissaoObj" style="color: red; padding:0; margin:0; font-size: 2.5vh; width: 100%; height: 4vh; background: transparent; border: 0">
      </fieldset>
      <i onclick="relatorio()" class="fa-regular fa-magnifying-glass-dollar font-color-navbar" style="font-size: 3.5vh; margin-left: 0.8vw; margin-top: 1vh; cursor: pointer"></i>
    </div>
  </div>

  <div class="flex-direction-column margin-left38" style="width: 92.5vw; display: flex; justify-content: center; margin-left: 6vw; margin-top: 1vh;">
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-comet font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Meta:</a>
      <a id="topMeta" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
      <a id="topComissao" class="font-color-navbar" style="padding-top: 0.5vh; font-size: 2.1vh; margin-top:0vh; font-weight: 600;"></a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-regular fa-scale-balanced font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Med. AF's Dia:</a>
      <a id="topAFsDia" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-ticket font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Tck. Médio:</a>
      <a id="topTicket" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-projector font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Projeção:</a>
      <a id="topProjecao" class="font-color-navbar" style="font-size: 2.3vh; margin-top:1vh; font-weight: 600;">0</a>
      <a id="topProjecaoCom" class="font-color-navbar" style="padding-top: 0.5vh; font-size: 2.2vh; margin-top:0vh; font-weight: 600;"></a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="far fa-money-check-edit font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">AF's Restante:</a>
      <a id="topAFsRestante" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-money-check-dollar font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Valor Restante:</a>
      <a id="topValorRestante" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-sack-dollar font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Valor Rest. Dia:</a>
      <a id="topValorDia" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
  </div>

  <div class="flex-direction-column margin-left18-5 width79" style="margin-block: 0.5vh; width: 92.5vw; display: flex; justify-content: center; margin-left: 6vw; margin-top: 1vh;">
    <div id="grafico1" class="background-image width79 height50" style="margin-block: 0.5vh; position: relative; height: 60vh; border-radius: 2vh; display: flex; flex-direction: column; align-items: center; width: 28vw; max-width: 28vw; overflow-x: hidden; margin-right: 2vw">
    
    </div>
    <div id="grafico2" class="background-image width79 height30" style="margin-block: 0.5vh; position: relative; height: 60vh; border-radius: 2vh; display: flex; flex-direction: column; align-items: center; width: 55vw; overflow-x: hidden">
      
    </div>
  </div>

  <div class="flex-direction-column margin-left38" style="width: 92.5vw; display: flex; justify-content: center; margin-left: 6vw; margin-top: 2vh;">
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-regular fa-money-bill-trend-up font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Liberado:</a>
      <a id="topLiberado" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="position: relative; margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i onclick="lotes()" class="fa-regular fa-magnifying-glass-dollar font-color-navbar" style="font-size: 2.5vh; cursor:pointer; position: absolute; right: 0.5vw; top: 0.5vw"></i>
      <i class="fa-solid fa-hexagon-check font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Sucessos:</a>
      <a onclick="downloadCSV('Sucessos')" id="topSucessos" class="font-color-navbar" style="cursor: pointer; text-decoration: underline; font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
      <a onclick="downloadTotalCSV('Sucessos')" id="topSucessosTotal" class="font-color-navbar" style="cursor: pointer; text-decoration: underline; font-size: 1.6vh; font-weight: 600;"></a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-hexagon-exclamation font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Erros:</a>
      <a onclick="downloadCSV('Erros')" id="topErros" class="font-color-navbar" style="cursor: pointer; text-decoration: underline; font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
      <a onclick="downloadTotalCSV('Erros')" id="topErrosTotal" class="font-color-navbar" style="cursor: pointer; text-decoration: underline; font-size: 1.6vh; font-weight: 600;"></a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-ballot-check font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Total:</a>
      <a id="topTotal" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-chart-simple font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">MED. P/DIA QNT.</a>
      <a id="topMedAfPorDiaQnt" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-regular fa-scale-balanced font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">MED. P/DIA VAL.</a>
      <a id="topMedAfPorDiaValor" class="font-color-navbar" style="font-size: 2.4vh; margin-top:1vh; font-weight: 600;">0</a>
    </div>
    <div class="background-image width40 height20" style="margin-bottom: 0.5vh; width: 10vw; border-radius: 2vh; height: 10vw; margin-inline: 0.6vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <i class="fa-solid fa-ticket font-color-navbar" style="font-size: 6vh"></i>
      <a style="font-size: 2.3vh; margin-top: 2vh; font-weight: 600;">Tck. Médio:</a>
      <a id="topTicket2" class="font-color-navbar" style="font-size: 2.4vh; margin-top: 1vh; font-weight: 600;">0</a>
    </div>
  </div>

  <div class="flex-direction-column margin-left18-5 width79" style="margin-block: 0.5vh; width: 92.5vw; display: flex; justify-content: center; margin-left: 6vw; margin-top: 1vh;">
    <div id="grafico3" class="background-image width79 height50" style="margin-block: 0.5vh; position: relative; height: 60vh; border-radius: 2vh; display: flex; flex-direction: column; align-items: center; width: 28vw; max-width: 28vw; overflow-x: hidden; margin-right: 2vw">
    
    </div>

    <div id="listLiberado">
    
    </div>
  </div>

</div>
<script>
  var total = []
  var sucessos = []
  var erros = []
  var agilus = []
  var block = false
  function relatorio() {
    if (block) return alert('Aguarde...')
    var objetivoReq = false
    if (!document.getElementById('objetivo').value) document.getElementById('objetivo').value = '100'
    objetivoReq = document.getElementById('objetivo').value.replace('%','')
    if (!Number(objetivoReq)) return alert('O objetivo deve ser um numero...')
    if (objetivoReq && !Number(objetivoReq)) return alert('O objetivo deve ser um numero...')
    var date = new Date();
    if (!document.getElementById('dateIni').value) document.getElementById('dateIni').value = date.toISOString().slice(0, 10)
    document.getElementById('topMeta').innerHTML = `0%`
    document.getElementById('topComissao').innerHTML = ``
    document.getElementById('topAFsDia').innerHTML = 0
    document.getElementById('topTicket').innerHTML = 0
    document.getElementById('topValorRestante').innerHTML = 0
    document.getElementById('topProjecao').innerHTML = `0%`
    document.getElementById('topProjecaoCom').innerHTML = ``
    document.getElementById('topAFsRestante').innerHTML = 0
    document.getElementById('topValorDia').innerHTML = 0
    document.getElementById('topLiberado').innerHTML = 0
    document.getElementById('topSucessos').innerHTML = 0
    document.getElementById('topErros').innerHTML = 0
    document.getElementById('topSucessosTotal').innerHTML = ``
    document.getElementById('topErrosTotal').innerHTML = ``
    document.getElementById('topTotal').innerHTML = 0
    document.getElementById('topMedAfPorDiaQnt').innerHTML = 0
    document.getElementById('topMedAfPorDiaValor').innerHTML = 0
    document.getElementById('topTicket2').innerHTML = 0
    document.getElementById('listLiberado').innerHTML = ``
    document.getElementById('grafico1').innerHTML = `<div style="width: 100%; height: 30vh; display: flex; justify-content: center; align-items: center"><div class="loader-wheel"></div><div class="loader-text font-5"></div></div>`
    document.getElementById('grafico2').innerHTML = `<div style="width: 100%; height: 30vh; display: flex; justify-content: center; align-items: center"><div class="loader-wheel"></div><div class="loader-text font-5"></div></div>`
    document.getElementById('grafico3').innerHTML = `<div style="width: 100%; height: 30vh; display: flex; justify-content: center; align-items: center"><div class="loader-wheel"></div><div class="loader-text font-5"></div></div>`
    block = true

    var url = document.getElementById('relatorio').value
    var funcionario = localStorage.getItem('user')
    if (document.getElementById('relatorio').value && document.getElementById('relatorio').value.includes('-')) {
      url = document.getElementById('relatorio').value.split('-')[0]
      funcionario = document.getElementById('relatorio').value.split('-')[1]
    }

    $.ajax({ type: "post",url: `${apiURL}/administrativo/relatorios/${url}`,
      data: JSON.stringify({
        user: localStorage.getItem('user'),
        password: localStorage.getItem('password'),
        dataMin: document.getElementById('dateIni').value,
        dataMax: document.getElementById('dateEnd').value,
        objetivo: objetivoReq,
        funcionario: funcionario,
      }), contentType:"application/json; charset=utf-8",
      success: async function(s) {
        block = false
        document.getElementById('grafico1').innerHTML = ``
        document.getElementById('grafico2').innerHTML = ``
        document.getElementById('grafico3').innerHTML = ``
        if (s.error) return alert(s.error)

        sucessos = s.fgts.sucessos
        erros = s.fgts.erros
        total = s.fgts.list
        for (var i = 1, n = 31; i <= n; ++i) { s.afs.months[i-1] = [i,0,0,0] }
        await s.calcular.midias.map(r=>{ s.afs.midias.find(r2=> r.midia == r2.midia).value = r.valor })
        var aux = [ s.mes-2, s.mes-1, s.mes ]
        await s.calcular.dias.map(r=>{
          if (s.afs.months.find(r2=>r2[0] == r.dia) && aux.find(r2=>r2==Number(r.mes))) s.afs.months.find(r2=>r2[0] == r.dia)[aux.findIndex(r2=>r2==Number(r.mes)) + 1] = r.valor
        })
        document.getElementById('topMeta').innerHTML = `${s.meta ? s.meta.replace('.',',') : 0}%`
        var comissaoMeta = comissao.find(r=>s.meta >= r.min && s.meta < r.max)
        if (comissaoMeta) document.getElementById('topComissao').innerHTML = `R$ ${comissaoMeta.comissao},00`
        document.getElementById('topAFsDia').innerHTML = s.afs.afsDia ? s.afs.afsDia : 0
        document.getElementById('topTicket').innerHTML = s.afs.ticket ? s.afs.ticket == "NaN" ? `R$ 0,00` : `R$ `+s.afs.ticket.replace('.',',') : 0
        document.getElementById('topValorRestante').innerHTML = s.afs.vlRestante ? `R$ `+s.afs.vlRestante.replace('.',',') : 0
        document.getElementById('topProjecao').innerHTML = `${s.afs.metaMes ? s.afs.metaMes : 0}%`
        var comissaoMeta = comissao.find(r=>s.afs.metaMes >= r.min && s.afs.metaMes < r.max)
        if (comissaoMeta) document.getElementById('topProjecaoCom').innerHTML = `R$ ${comissaoMeta.comissao},00`
        document.getElementById('topAFsRestante').innerHTML = s.afs.afsRestante ? s.afs.afsRestante.replace('.',',') : 0
        document.getElementById('topValorDia').innerHTML = s.afs.valorDia ? s.afs.valorDia.replace('.',',') : 0
        document.getElementById('grafico1').innerHTML = `
          <a class="font-1" style="font-size: 4vh; margin-top: 4vh">Mídias</a>
          <canvas id="graficoMidias" class="width80" style="position: absolute; top: 5.5vh; width: 26vw; margin-top: 6vh"></canvas>
          <div class="margin-top25" style="display: flex; margin-top: 34vh; width: 80%; margin-inline: 10%">
            <div style="display: flex; flex-direction: column; min-width: 45%; text-align: left">
              ${s.afs.midias.slice(0,s.afs.midias.length/2).map(r=>
                `<a style="border-left: 0.8vh solid ${r.color}; border-radius: 0.3vh; margin-block: 0.4vh; padding-left: 0.6vw; font-size: 1.8vh;">
                  ${r.label} <span style="font-size: 1.6vh">${Number(r.value * 100 / s.afs.vlMidias) ? (r.value * 100 / s.afs.vlMidias).toFixed(2) : '0'}%</span>
                </a>`
              ).join('')}
            </div>
            <div style="display: flex; flex-direction: column; width: 45% text-align: right; margin-left: 10%">
              ${s.afs.midias.slice(s.afs.midias.length/2,s.afs.midias.length).map(r=>
                `<a style="border-left: 0.8vh solid ${r.color}; border-radius: 0.3vh; margin-block: 0.4vh; padding-left: 0.6vw; font-size: 1.8vh;">
                  ${r.label} <span style="font-size: 1.6vh">${Number(r.value * 100 / s.afs.vlMidias) ? (r.value * 100 / s.afs.vlMidias).toFixed(2) : '0'}%</span>
                </a>`
              ).join('')}
            </div>
          </div>
        `
        var graficoMidias = document.getElementById("graficoMidias").getContext("2d");
        new Chart(graficoMidias).Doughnut(s.afs.midias);

        var months = {
          '1': 'Janeiro',
          '2': 'Fevereiro',
          '3': 'Março',
          '4': 'Abril',
          '5': 'Maio',
          '6': 'Junho',
          '7': 'Julho',
          '8': 'Agosto',
          '9': 'Setembro',
          '10': 'Outubro',
          '11': 'Novembro',
          '12': 'Dezembro'
        }
        document.getElementById('grafico2').innerHTML = `
          <a class="font-1" style="font-size: 4vh; margin-top: 4vh">Pago por Dia</a>
          <div id="graficoMeses" class="width85 height18" style="position: absolute; left: -1vw; top: 15vh; width:60vw; height: 23vw; margin-top: -6vh; font-weight: 600"></div>
        `
        google.charts.load('current', {packages: ['corechart', 'line']});
        google.charts.setOnLoadCallback(drawCurveTypes);
        function drawCurveTypes() {
          var data = new google.visualization.DataTable();
          data.addColumn('number', 'X');
          data.addColumn('number', months[s.mes-2]);
          data.addColumn('number', months[s.mes-1]);
          data.addColumn('number', months[s.mes]);
          data.addRows(s.afs.months);
          var optionsGraficoMeses = {
            legend: { position: 'bottom', textStyle: {color: '#01579b'} },
            hAxis: { 
              textStyle: { color: '#01579b', fontName: 'Arial', bold: true, italic: true },
              titleTextStyle: { color: '#01579b', fontName: 'Arial', bold: true, italic: true },
            },
            vAxis: {
              textStyle: { color: '#01579b', fontName: 'Arial', bold: true, italic: true },
              titleTextStyle: { color: '#01579b', fontName: 'Arial', bold: true, italic: true },
            },
            backgroundColor: 'transparent',
          };
          var graficoMeses = new google.visualization.LineChart(document.getElementById('graficoMeses'));
          graficoMeses.draw(data, optionsGraficoMeses);
        }

        document.getElementById('topLiberado').innerHTML = s.fgts.liberado ? `R$ `+String(s.fgts.liberado).replace('.',',') : 0
        document.getElementById('topSucessos').innerHTML = s.fgts.sucess
        document.getElementById('topErros').innerHTML = s.fgts.error
        document.getElementById('topSucessosTotal').innerHTML = `Total: `+s.fgts.list.filter(r=>!r.error).length
        document.getElementById('topErrosTotal').innerHTML = `Total: `+s.fgts.list.filter(r=>!r.liberado).length
        document.getElementById('topTotal').innerHTML = s.fgts.total
        document.getElementById('topMedAfPorDiaQnt').innerHTML = s.fgts.medQnt
        document.getElementById('topMedAfPorDiaValor').innerHTML = `R$ ${s.fgts.medValor.replace('.',',')}`
        document.getElementById('topTicket2').innerHTML = s.fgts.ticket && Number(s.fgts.ticket) ? s.fgts.ticket == "NaN" ? `R$ 0,00` : `R$ `+s.fgts.ticket.replace('.',',') : 0
        document.getElementById('grafico3').innerHTML = `
          <a class="font-1" style="font-size: 4vh; margin-top: 4vh">Bancos</a>
          <canvas id="graficoBanks" class="width80" style="position: absolute; top: 5.5vh; width: 26vw; margin-top: 6vh"></canvas>
          <div class="margin-top25" style="display: flex; margin-top: 36vh; width: 90%; margin-inline: 10%">
            <div style="display: flex; flex-direction: column; width: 50%; text-align: left">
              ${s.fgts.banks.slice(0,s.fgts.banks.length/2).map(r=>
                `<a style="border-left: 0.8vh solid ${r.color}; border-radius: 0.3vh; margin-block: 0.4vh; padding-left: 0.6vw; font-size: 1.8vh;">
                  ${r.label} <span style="font-size: 1.6vh">${r.value  == 0.00 || r.value == "NaN" ? 0 : r.value}%</span>
                </a>`
              ).join('')}
            </div>
            <div style="display: flex; flex-direction: column; width: 50% text-align: right; margin-left: 10%">
              ${s.fgts.banks.slice(s.fgts.banks.length/2,s.fgts.banks.length).map(r=>
                `<a style="border-left: 0.8vh solid ${r.color}; border-radius: 0.3vh; margin-block: 0.4vh; padding-left: 0.6vw; font-size: 1.8vh;">
                  ${r.label} <span style="font-size: 1.6vh">${r.value  == 0.00 || r.value == "NaN" ? 0 : r.value}%</span>
                </a>`
              ).join('')}
            </div>
          </div>
        `
        var graficoBanks = document.getElementById("graficoBanks").getContext("2d");
        new Chart(graficoBanks).Pie(s.fgts.banks);
        if (s.fgts.agilus) {
          document.getElementById('listLiberado').innerHTML = `<div class="background-image width79 height50" style="margin-block: 0.5vh; position: relative; height: 60vh; max-height: 60vh; overflow-y: auto; border-radius: 2vh; display: flex; flex-direction: column; align-items: center; width: 40vw; max-width: 40vw; overflow-x: hidden; margin-right: 2vw">
            <div id="listaLiberado" style="width: 100%; margin-top: 1.5vh">
              <div style="display: flex; width: 94%; margin-top: 0.3vh; border-bottom: 0.1vh solid gray; margin-inline: 3%">
                <div title="Nome Funcionário" style="width: 38%; max-width: 38%; padding-left: 2%">
                  <a style="font-size: 2.8vh; font-weight: 800">Nome</a>
                  <i onclick="redirect('user')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
                  <input type="hidden" id="user_list" value="0">
                </div>
                <div title="Valor Liberado" style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
                  <a style="font-size: 2.5vh; font-weight: 800">VL. S</a>
                  <i onclick="redirect('liberado')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
                  <input type="hidden" id="liberado_list" value="0">
                </div>
                <div title="Quantidade de Sucessos" style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
                  <a style="font-size: 2.5vh; font-weight: 800">S</a>
                  <i onclick="redirect('sucessos')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
                  <input type="hidden" id="sucessos_list" value="0">
                </div>
                <div title="Quantidade de Erros" style="width: 8%; max-width: 8%; text-align: center; border-left: 0.1vh solid gray">
                  <a style="font-size: 2.5vh; font-weight: 800">E</a>
                  <i onclick="redirect('erros')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
                  <input type="hidden" id="erros_list" value="0">
                </div>
                <div title="Quantidade de AFs(Consultados)" style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
                  <a style="font-size: 2.5vh; font-weight: 800">AF</a>
                  <i onclick="redirect('afs')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
                  <input type="hidden" id="afs_list" value="0">
                </div>
                <div title="Valor das AFs(Consultados)" style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
                  <a style="font-size: 2.5vh; font-weight: 800">VL. AFs</a>
                  <i onclick="redirect('valorAfs')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
                  <input type="hidden" id="valorAfs_list" value="0">
                </div>
              </div>
            </div>
          </div>`
          s.fgts.agilus.forEach((element,index)=>{
            s.fgts.agilus[index].erros =  s.fgts.erros.filter(r=>r.user == element.user).length
            document.getElementById('listaLiberado').innerHTML += `
            <div style="display: flex; width: 94%; border-bottom: 0.1vh solid gray; margin-inline: 3%">
              <div style="width: 38%; max-width: 38%; padding-left: 2%">
                <a style="font-size: 2.3vh">${element.user}</a>
              </div>
              <div style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
                <a style="font-size: 2vh">${String(element.liberado).replace('.',',').replace('null','0,00')}</a>
              </div>
              <div style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
                <a style="font-size: 2vh">${element.sucessos}</a>
              </div>
              <div style="width: 8%; max-width: 8%; text-align: center; border-left: 0.1vh solid gray">
                <a style="font-size: 2vh">${element.erros}</a>
              </div>
              <div style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
                <a style="font-size: 2vh">${element.afs ? element.afs : 0}</a>
              </div>
              <div style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
                <a style="font-size: 2vh">${element.valorAfs ? String(element.valorAfs).replace('.',',') : '0,00'}</a>
              </div>
            </div>
            `
          })
          agilus = s.fgts.agilus
        }
      },
      error: function(e) {
        block = false
        document.getElementById('grafico1').innerHTML = ``
        document.getElementById('grafico2').innerHTML = ``
        document.getElementById('grafico3').innerHTML = ``
        if (e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`A minha API demorou muito para retornar uma resposta valida...`)
      }
    })
  }

  var blockRedirect = false
  function redirect(menu) {
    if (blockRedirect) return alert('Aguarde...')
    if (!agilus || agilus.length < 1) return alert('Lista vazia...')
    if (!menu) return alert('Campo não informado...')
    blockRedirect = true
    var aux = 0
    if (document.getElementById(`${menu}_list`) && document.getElementById(`${menu}_list`).value == '1') aux = 1
    document.getElementById('listaLiberado').innerHTML = `<div style="width: 100%; height: 30vh; display: flex; justify-content: center; align-items: center"><div class="loader-wheel"></div><div class="loader-text font-5"></div></div>`
    if (aux == 0) {
      agilus.sort(function(a, b) {
        var aux1 = String(a[menu]).replace(',','.')
        var aux2 = String(b[menu]).replace(',','.')
        if (aux1 == '0') aux1 = -1
        if (aux2 == '0') aux2 = -1
        if (Number(aux1) && Number(aux2)) return aux1-aux2
        return aux2.localeCompare(aux1)
      });
    } else if (aux == 1) agilus.reverse()
    document.getElementById('listaLiberado').innerHTML = `
      <div style="display: flex; width: 94%; margin-top: 0.3vh; border-bottom: 0.1vh solid gray; margin-inline: 3%">
        <div title="Nome Funcionário" style="width: 38%; max-width: 38%; padding-left: 2%">
          <a style="font-size: 2.8vh; font-weight: 800">Nome</a>
          <i onclick="redirect('user')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
          <input type="hidden" id="user_list" value="0">
        </div>
        <div title="Valor Liberado" style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2.5vh; font-weight: 800">VL. S</a>
          <i onclick="redirect('liberado')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
          <input type="hidden" id="liberado_list" value="0">
        </div>
        <div title="Quantidade de Sucessos" style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2.5vh; font-weight: 800">S</a>
          <i onclick="redirect('sucessos')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
          <input type="hidden" id="sucessos_list" value="0">
        </div>
        <div title="Quantidade de Erros" style="width: 8%; max-width: 8%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2.5vh; font-weight: 800">E</a>
          <i onclick="redirect('erros')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
          <input type="hidden" id="erros_list" value="0">
        </div>
        <div title="Quantidade de AFs(Consultados)" style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2.5vh; font-weight: 800">AF</a>
          <i onclick="redirect('afs')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
          <input type="hidden" id="afs_list" value="0">
        </div>
        <div title="Valor das AFs(Consultados)" style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2.5vh; font-weight: 800">VL. AFs</a>
          <i onclick="redirect('valorAfs')" class="fa-regular fa-arrows-up-down font-color-navbar" style="font-size: 2vh; cursor: pointer"></i>
          <input type="hidden" id="valorAfs_list" value="0">
        </div>
      </div>
    `
    if (aux == 0) document.getElementById(`${menu}_list`).value = '1'
    if (aux == 1) document.getElementById(`${menu}_list`).value = '0'
    agilus.forEach((element,index)=>{
      document.getElementById('listaLiberado').innerHTML += `
      <div style="display: flex; width: 94%; border-bottom: 0.1vh solid gray; margin-inline: 3%">
        <div style="width: 38%; max-width: 38%; padding-left: 2%">
          <a style="font-size: 2.3vh">${element.user}</a>
        </div>
        <div style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2vh">${String(element.liberado).replace('.',',').replace('null','0,00')}</a>
        </div>
        <div style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2vh">${element.sucessos}</a>
        </div>
        <div style="width: 8%; max-width: 8%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2vh">${element.erros}</a>
        </div>
        <div style="width: 7%; max-width: 7%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2vh">${element.afs ? element.afs : 0}</a>
        </div>
        <div style="width: 17%; max-width: 17%; text-align: center; border-left: 0.1vh solid gray">
          <a style="font-size: 2vh">${element.valorAfs ? String(element.valorAfs).replace('.',',') : '0,00'}</a>
        </div>
      </div>
      `
    })
    blockRedirect = false
  }

  var comissao = [
    { min: 50, max: 70, comissao: 200 },
    { min: 70, max: 100, comissao: 300 },
    { min: 100, max: 130, comissao: 800 },
    { min: 130, max: 150, comissao: 1600 },
    { min: 150, max: 180, comissao: 2000 },
    { min: 180, max: 200, comissao: 3000 },
    { min: 200, max: 250, comissao: 3500 },
    { min: 250, max: 300, comissao: 5000 },
    { min: 300, max: 330, comissao: 6000 },
    { min: 330, max: 360, comissao: 7000 },
    { min: 360, max: 400, comissao: 8000 },
    { min: 400, max: 9999999, comissao: 10000 },
  ]
  function changeComissao() {
    if (document.getElementById('objetivo').value) {
      var meta = document.getElementById('objetivo').value.replace('%','')
      if (!meta || !Number(meta)) return document.getElementById('comissaoObj').value = `R$ 00,00`;
      var comissaoMeta = comissao.find(r=>meta >= r.min && meta < r.max)
      if (comissaoMeta) {
        document.getElementById('comissaoObj').value = `R$ ${comissaoMeta.comissao},00`
      } else document.getElementById('comissaoObj').value = `R$ 00,00`
    } else document.getElementById('comissaoObj').value = `R$ 00,00`
  }

  async function downloadCSV(type) {
    return alert('Você não baixar as consultas por aqui...')
    if (block) return alert('Aguarde...')
    block = true
    var csv = false
    if (type == 'Sucessos') {
      if (!sucessos || sucessos.length <= 0) return alert(`A lista de resultados está vazia...`)
      csv = `CPF,BANCO,TOTAL,LIBERADO,TELEFONE,DATA,AUTOR`
      await sucessos.map((element,index)=>{
        csv+=`\n${element.cpf},${element.bank},${String(element.total).replaceAll(',','.')},${String(element.liberado).replaceAll(',','.')},${element.telefone},${element.data},${element.user}`
      })
    } else {
      if (!erros || erros.length <= 0) return alert(`A lista de resultados está vazia...`)
      csv = `CPF,BANCO,ERRO,TELEFONE,AUTOR`
      await erros.map((element,index)=>{
        csv+=`\n${element.cpf},${element.bank},${element.error.replaceAll(`,`,'.')},${element.telefone},${element.user}`
      })
    }
    var a = document.createElement('a');
    a.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    a.target = '_blank';
    a.download = `relatoriosFGTS-${type}.csv`;
    a.click();
    block = false
  }

  async function downloadTotalCSV(type) {
    return alert('Você não baixar as consultas por aqui...')
    if (block) return alert('Aguarde...')
    if (!total || total.length <= 0) return alert(`A lista de resultados está vazia...`)
    block = true
    var csv = false
    if (type == 'Sucessos') {
      csv = `CPF,BANCO,TOTAL,LIBERADO,TELEFONE,DATA,AUTOR`
      await total.filter(r=>r.liberado).map((element,index)=>{
        csv+=`\n${element.cpf},${element.bank},${String(element.total).replaceAll(',','.')},${String(element.liberado).replaceAll(',','.')},${element.telefone},${element.data},${element.user}`
      })
    } else {
      csv = `CPF,BANCO,ERRO,TELEFONE,AUTOR`
      await total.filter(r=>r.error).map((element,index)=>{
        csv+=`\n${element.cpf},${element.bank},${element.error.replaceAll(`,`,'.')},${element.telefone},${element.user}`
      })
    }
    var a = document.createElement('a');
    a.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    a.target = '_blank';
    a.download = `relatoriosFGTS-${type}.csv`;
    a.click();
    block = false
  }

  async function lotes() {
    return alert('Você não pode consultar em lotes por aqui...')
    if (sucessos && sucessos.length <= 0) return alert('Lista vazia...') 
    var csv = ''
    await sucessos.filter(r=>r.liberado).map((element,index)=>{
      csv+=`${index != 0 ? '\n' : ''}${element.cpf};${element.bank},`
    })
    if (window.clipboardData) {
      window.clipboardData.setData("Text", csv);
      return window.location = `/consultas/lotes`
    } else {
      navigator.clipboard.writeText(csv).then(()=>{
        return window.location = `/consultas/lotes`
      }).catch(()=>{ 
        alert('Não foi possivel copiar os CPFs e os bancos! Então sera baixado em CSV...')
        var a = document.createElement('a');
        a.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
        a.target = '_blank';
        a.download = `CPFs-Consultas.csv`;
        a.click();
        return window.location = `/consultas/lotes`
      })
    }
  }

  (async function () {
    var date = new Date();
    document.getElementById('dateIni').value = date.toISOString().slice(0, 10)
    return relatorio()
  })();
</script>
