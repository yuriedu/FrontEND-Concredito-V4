<div id="propostasPage" style="max-height: 100vh; overflow: auto; position: absolute; top: 0; left: 0; width: 100vw; height: 100vh">
  <navbar id="navbar"></navbar>
  <script>$("#navbar").load(`/views/imports/navbar.html`)</script>

  <div class="background-image margin-left18-5 width79 min-height33" style="margin-top: 12.5vh; margin-left: 6vw; width: 92.5vw; min-height: 37vh; border-radius: 2vh">
    <a style="display: flex; width: 100%; justify-content: center; padding-top: 2vh; font-size: 3vh">Filtro de Propostas:</a>
    <div style="width: 100%; display: flex; flex-direction: row; justify-content: center; font-size: 1.7vh;">
      <fieldset title="Fase atual da proposta..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Fase</legend>
        <select id="fase" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0">
          <option style="color: black" value="" selected>Todas</option>
          <optgroup style="color: black!important" label="Principais">
            <option style="color: black" value="1">Inclusão sem Conferência</option>
          </optgroup>
          <optgroup style="color: black!important" label="Robô">
            <option style="color: black" value="822">Aguardando Digitação - ROBO</option>
            <option style="color: black" value="15">Em Digitação - ROBO</option>
            <option style="color: black" value="824">Não Digitado - ROBO</option>
            <option style="color: black" value="823">Digitado Sucesso - ROBO</option>
          </optgroup>
          <optgroup style="color: black!important" label="Esteira">
            <option style="color: black" value="2">Aguardando Averbação</option>
            <option style="color: black" value="9">Pêndente</option>
            <option style="color: black" value="692">Analise Banco</option>
            <option style="color: black" value="4002">Assinado/Respondido</option>
            <option style="color: black" value="1111">Atuação Master</option>
          </optgroup>
        </select>
      </fieldset>
      <fieldset title="Banco do Contrato da proposta..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Banco</legend>
        <select id="bank" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0">
          <option style="color: black" value="" selected>Todos</option>
          <option style="color: black" value="2020">FACTA FINANCEIRA</option>
          <option style="color: black" value="626">BANCO C6</option>
          <option style="color: black" value="623">PANAMERICANO</option>
          <option style="color: black" value="389">MERCANTIL</option>
          <option style="color: black" value="318">BMG</option>
          <option style="color: black" value="422">SAFRA</option>
          <option style="color: black" value="41">BANRISUL</option>
          <option style="color: black" value="290">PagBank</option>
        </select>
      </fieldset>
      <fieldset title="Orgão do Contrato da proposta..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Orgão</legend>
        <select id="orgao" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0">
          <option style="color: black" value="" selected>Todos</option>
          <option style="color: black" value="23">FGTS</option>
          <option style="color: black" value="1">INSS</option>
          <option style="color: black" value="7">CARTÃO INSS</option>
        </select>
      </fieldset>
    </div>

    <div style="width: 100%; display: flex; flex-direction: row; justify-content: center; font-size: 1.7vh; font-size: 1.7vh;">
      <fieldset title="CPF do cliente..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">CPF</legend>
        <input id="cpf" type="number" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0" placeholder="000.000.000.00">
      </fieldset>
      <fieldset title="Codigo da AF..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Cod. AF</legend>
        <input id="codAF" type="number" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0" placeholder="000000">
      </fieldset>
      <fieldset title="Codigo do Contrato..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Cod. Contr<span class="invisibleAndroid">ato</span></legend>
        <input id="codContrato" type="number" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0" placeholder="00000000">
      </fieldset>
    </div>
    <div style="width: 100%; display: flex; flex-direction: row; justify-content: center; font-size: 1.7vh;">
      <fieldset title="Data Minima..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Data Inicio</legend>
        <input id="dateIni" type="date" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0">
      </fieldset>
      <fieldset title="Data Maxima..." style="padding: 0; border-radius: 0.6vh; width: 25%; margin-inline: 1%; padding-inline: 1%;">
        <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Data Final</legend>
        <input id="dateEnd" type="date" style="font-size: 2.1vh; width: 100%; height: 3vh; padding:0; margin:0; background: transparent; border: 0">
      </fieldset>
    </div>
    <div style="width: 100%; display: flex; justify-content: center">
      <div id="filter" onclick="filter()" class="buttonLogin" style="width: 30%; margin-top: 3vh; font-size: 2.8vh; padding-block: 1.5vh; border-radius: 1.5vh">
        <a>Filtrar</a>
      </div>
    </div>
  </div>

  <div class="background-image margin-left18-5 width79" style="margin-top: 3vh; display: flex; margin-left: 6vw; width: 92.5vw; min-height: 12vh; border-radius: 2vh; text-align: center; justify-content: center; align-items: center; font-size: 1.7vh;">
    <fieldset title="Pesquise alguma proposta por aqui..." style="padding: 0; margin: 0; border-radius: 0.6vh; width: 50%; margin-inline: 1%; padding-inline: 1%;">
      <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Pesquisar</legend>
      <input onkeyup="searchBar()" id="searchBar" placeholder="Pesquise alguma proposta aqui..." style="padding:0; margin:0; font-size: 2.5vh; width: 100%; height: 4vh; background: transparent; border: 0">
    </fieldset>
    <i onclick="searchBar()" class="fa-regular fa-magnifying-glass-dollar" style="font-size: 3.5vh; margin-top: 1.5vh; cursor: pointer"></i>
  </div>

  <div class="background-image margin-left18-5 width79 min-height36-5" style="margin-top: 3vh; margin-left: 6vw; width: 92.5vw; min-height: 32.5vh; border-top-left-radius: 2vh; border-top-right-radius: 2vh;">
    <div id="propostas-lista" style="margin-inline: 3%; padding-block: 2%;">
      <a class="line-bottom font-size2" style="font-size: 3vh; display: flex; margin-inline: 20%; width: 60%; justify-content: center">Nenhuma proposta encontrada...</a>
    </div>
  </div>
  <div id="menuPropostas"></div>
  <div id="generator" class="background-reverse left18-5 width79 font-color-reverse" style="z-index: 5;display: none; position: fixed; top: 20%; left: 20%; width: 60%; height: 60%; border-radius: 5vh;">
    <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
      <div style="position:absolute; top: 2vh; right: 3vh; cursor: pointer">
        <i onclick="closeGenerator()" class="far fa-times" style="cursor: pointer; font-size: 3.5vh;"></i>
      </div>
      <a style="font-size: 3vh">Gerador de Cadastros:</a>
      <div style="display: flex; width: 65%;">
        <fieldset id="fieldset" title="Codigo 2" style="margin-top: 5vh; text-align: left; padding: 0; border-radius: 0.6vh; width: 95%; margin-inline: 1%; padding-inline: 1%;">
          <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Codigo 1</legend>
          <textarea rows="4" class="font-1 font-color-reverse" placeholder="Nenhum codigo gerado..." id="code1" style="font-size: 2.4vh; width: 100%; padding:0; margin:0; background: transparent; border: 0" disabled></textarea>
        </fieldset>
        <i onclick="copyGenerator('code1')" class="fas fa-copy" style="margin-top:7vh; cursor: pointer; font-size: 3vh;"></i>
      </div>
      <div style="display: flex; width: 65%;">
        <fieldset id="fieldset" title="Codigo 1" style="margin-top: 3vh; text-align: left; padding: 0; border-radius: 0.6vh; width: 95%; margin-inline: 1%; padding-inline: 1%;">
          <legend class="font-4 font-size1-5" style="margin: 0; padding: 0; font-size: 2.3vh">Codigo 2</legend>
          <textarea rows="4" class="font-1 font-color-reverse" placeholder="Nenhum codigo gerado..." id="code2" style="font-size: 2.4vh; width: 100%; padding:0; margin:0; background: transparent; border: 0" disabled></textarea>
        </fieldset>
        <i onclick="copyGenerator('code2')" class="fas fa-copy" style="margin-top: 6vh; cursor: pointer; font-size: 3vh;"></i>
      </div>
    </div>
  </div>
</div>

<script>
const fasesName = {
  '1': 'Inclusão sem conferência',
  '2': 'AGUARDANDO AVERBAÇÃO',
  '9': 'PENDENTE',
  '11': 'Aguardando Retorno CIP',
  '12': 'Pendência Resolvida',
  '15': 'EM DIGITAÇÃO-ROBO',
  '323': 'AGUARDA AUMENTO INSS',
  '692': 'PROPOSTA EM ANALISE BANCO',
  '822': 'AGUARDANDO DIGITAÇÃO AUTOMÁTICA - ROBÔ',
  '823': 'DIGITADO SUCESSO - ROBÔ',
  '824': 'NÃO DIGITADO --ERRO-- ROBÔ',
  '1111': 'AGUARDANDO ATUAÇÃO MASTER',
  '3920': 'PROPOSTA PAGA',
  '4002': 'ASSINADO / RESPONDIDO',
  '10293': 'Verificação manual OP',
  '100023': 'PAGAMENTO DEVOLVIDO',
  '120001': 'PENDENTE POR ASSINATURA',
  '202552': 'Envia Requisição CIP',
}

  var menuPropostaActual = false
  function menuPropostas(icon, codAF, bank) {
    if (menuPropostaActual) {
      document.getElementById(`menuProposta`).innerHTML = ``
      if (menuPropostaActual == codAF) return menuPropostaActual = false
      menuPropostaActual = false
    }
    menuPropostaActual = codAF
    document.getElementById(`menuPropostas`).innerHTML = `<div id="menuProposta"><div class="background-reverse width35" style="z-index: 2; width: 8vw; border-radius: 1.5vh; font-size: 2vh; position: absolute; top: ${$(icon).offset().top+document.getElementById('propostasPage').scrollTop}px; left: calc(${$(icon).offset().left}px - (${window.screen.width < 900 ? '35.2vw' : '8.2vw'}) ); display: flex; flex-direction: column; text-align: center; padding-block: 0.8vh"><a onclick="cadastrar('${codAF}','${bank}')" class="line-bottom-reverse navbar-color-select" style="cursor: pointer; padding-block: 0.6vh">Cadastrar</a><a onclick="checkEsteira('${codAF}')" class="line-bottom-reverse navbar-color-select" style="cursor: pointer; padding-block: 0.6vh">Esteira</a><a onclick="generator('${codAF}')" class="line-bottom-reverse navbar-color-select" style="cursor: pointer; padding-block: 0.6vh">Gerar Cadastro</a><a onclick="changeFase('${codAF}',1)" class="navbar-color-select" style="cursor: pointer; padding-block: 0.6vh">Fase Inclusão</a></div></div>`
  }

  function filter() {
    if (document.getElementById('filter').classList.contains('buttonBlock')) return alert('Aguarde...')
    document.getElementById('filter').innerHTML = `<i class="fad fa-spinner-third fa-spin"></i>`
    document.getElementById('filter').classList.add("buttonBlock");
    if (menuPropostaActual) menuPropostas(false, menuPropostaActual)
    document.getElementById('propostas-lista').innerHTML = `<div style="width: 100%; height: 30vh; display: flex; justify-content: center; align-items: center"><div class="loader-wheel"></div><div class="loader-text font-5"></div></div>`
    $.ajax({ type: "post", url: `http://localhost:3000/propostas/lista`, data: JSON.stringify({
      user: localStorage.getItem('user'), 
      password: localStorage.getItem('password'),
      fase: document.getElementById('fase') && document.getElementById('fase').value ? document.getElementById('fase').value : false,
      bank: document.getElementById('bank') && document.getElementById('bank').value ? document.getElementById('bank').value : false,
      orgao: document.getElementById('orgao') && document.getElementById('orgao').value ? document.getElementById('orgao').value : false,
      cpf: document.getElementById('cpf') && document.getElementById('cpf').value ? document.getElementById('cpf').value : false,
      codAF: document.getElementById('codAF') && document.getElementById('codAF').value ? document.getElementById('codAF').value : false,
      codContrato: document.getElementById('codContrato') && document.getElementById('codContrato').value ? document.getElementById('codContrato').value : false,
      agente: document.getElementById('agente') && document.getElementById('agente').value ? document.getElementById('agente').value : false,
      dateIni: document.getElementById('dateIni') && document.getElementById('dateIni').value ? document.getElementById('dateIni').value : false,
      dateEnd: document.getElementById('dateEnd') && document.getElementById('dateEnd').value ? document.getElementById('dateEnd').value : false,
    }),contentType:"application/json; charset=utf-8",
      success: function(s) {
        document.getElementById('filter').innerHTML = `<p class="font-1">Filtrar</p>`
        document.getElementById('filter').classList.remove("buttonBlock");
        document.getElementById('propostas-lista').innerHTML = `<a class="line-bottom" style="font-size: 3vh; display: flex; margin-inline: 20%; width: 60%; justify-content: center">Nenhuma proposta encontrada...</a>`
        if (s.error) return alert(s.error)
        if (s.propostas && s.propostas.length >= 1) {
          document.getElementById('propostas-lista').innerHTML = ``
          s.propostas.forEach((element,index)=>{
            if (element.codOrgaoAF == 23) element.orgaoName = "FGTS"
            if (element.codOrgaoAF == 1) element.orgaoName = "INSS"
            if (element.codOrgaoAF == 7) element.orgaoName = "CARTÃO INSS"
            if (!element.orgaoName) element.orgaoName = "???"
            document.getElementById('propostas-lista').innerHTML += `<proposta><a style="display:none">${JSON.stringify(element)}</a><div id="proposta_${element.codAF}" class="background-Propostas" style="z-index: 1; position: relative; border-radius: 1.5vh; margin-block: 2.5vh"><div class="line-bottom navbar-font-color font-4" style="display: flex; flex-direction: row; align-items: center; height: 6vh; font-size: 2.2vh; padding-inline: 1%;"><a class="max-width30p" title="${element.bancoAF}" style="max-width: 15%; margin-left: 0.8%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="far fa-landmark font-size2"></i><span class="invisibleAndroid"> BANCO: </span>${element.bancoAF}</a><a class="max-width30p" title="${element.orgaoName}" style="max-width: 15%; margin-left: 0.8%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="far fa-bookmark font-size2"></i><span class="invisibleAndroid"> ORGÃO: </span>${element.orgaoName}</a><a class="invisibleAndroid" title="${element.valorAF}" style="max-width: 15%; margin-left: 0.8%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="far fa-sack-dollar font-size2"></i><span class="invisibleAndroid"> VL. AF: </span>${element.valorAF}</a><a class="invisibleAndroid" title="${element.parcela}" style="max-width: 15%; margin-left: 0.8%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="fal fa-table font-size2"></i><span class="invisibleAndroid"> PARCELAS: </span>${element.parcela}</a><a class="max-width30p" title="${element.codAF}" style="max-width: 15%; margin-left: 0.8%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="far fa-file-code font-size2"></i><span class="invisibleAndroid"> COD. AF: </span>${element.codAF}</a><a class="invisibleAndroid" title="${element.Tabela}" style="max-width: 15%; margin-left: 0.8%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="far fa-table font-size2"></i><span class="invisibleAndroid"> TABELA: </span>${element.Tabela}</a><i id="menu_${element.codAF}" onclick="menuPropostas(this, ${element.codAF}, '${element.bancoAF}')" class="fa-solid fa-ellipsis-vertical font-size2 navbar-color-select" style="cursor: pointer; position: absolute; right: 1%"></i></div><div style="display: flex; flex-direction: row; align-items: center; height: 9.5vh; font-size: 2.2vh; padding-inline: 1%;"><fieldset class="width30p" title="${element.nome}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 18%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Nome</legend><input disabled value="${element.nome}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="width30p" title="${element.cpf}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 8%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">CPF</legend><input disabled value="${element.cpf}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="invisibleAndroid" title="${element.rg}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 5%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">RG</legend><input disabled value="${element.rg}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="invisibleAndroid" title="${element.cep}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 6%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">CEP</legend><input disabled value="${element.cep}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="invisibleAndroid" title="${element.codBanco}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 10%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Banco</legend><input disabled value="${element.codBanco}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="invisibleAndroid" title="${element.agencia}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 3%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Agência</legend><input disabled value="${element.agencia}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="invisibleAndroid" title="${element.contaCorrente}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 5%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Conta</legend><input disabled value="${element.contaCorrente}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset><fieldset class="width30p" id="title_${element.codAF}" title="Fase: ${fasesName[element.codFase] ? fasesName[element.codFase] : element.codFase}" style="padding: 0; margin: 0; border-radius: 0.6vh; width: 20.5%; margin-left: 0.5%; padding-inline: 1%;"><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Situação</legend><input id="situation_${element.codAF}" disabled value="Fase: ${fasesName[element.codFase] ? fasesName[element.codFase] : element.codFase}" style="font-size: 2.1vh; width: 100%; height: 3.5vh; padding:0; margin:0; background: transparent; border: 0"></fieldset></div></proposta>`
            if (element.codFase == 15) return situation(element.codAF, true, element.bancoAF)
          })
        }
      },
      error: function(e) {
        document.getElementById('filter').innerHTML = `<p class="font-1">Filtrar</p>`
        document.getElementById('filter').classList.remove("buttonBlock");
        if (e.error) return alert(e.error)
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    });
  }

  function cadastrar(codAF, bankAF) {
    if (menuPropostaActual) menuPropostas(false, menuPropostaActual)
    if (document.getElementById(`situation_${codAF}`).style.color == `blue`) return alert('Proposta já está sendo cadastrada...')
    document.getElementById(`situation_${codAF}`).style.color = `blue`
    document.getElementById(`situation_${codAF}`).value = 'Entrando na fila...'
    setTimeout(function(){ situation(codAF, false, bankAF) }, 1500)
    $.ajax({ type: "post", url: `http://localhost:3000/propostas/cadastrar`, data: JSON.stringify({
      user: localStorage.getItem('user'), 
      password: localStorage.getItem('password'),
      proposta: codAF,
    }),contentType:"application/json; charset=utf-8",
      success: function(s) {
        if (s.error) {
          document.getElementById(`situation_${codAF}`).style.color = `red`
          document.getElementById(`situation_${codAF}`).value = s.error
          return document.getElementById(`title_${codAF}`).title = s.error
        }
        document.getElementById(`situation_${codAF}`).style.color = `green`
        document.getElementById(`situation_${codAF}`).value = s.data
        return document.getElementById(`title_${codAF}`).title = s.data
      },
      error: function(e) {
        if (e.error) {
          document.getElementById(`situation_${codAF}`).style.color = `red`
          document.getElementById(`situation_${codAF}`).value = e.error
          return document.getElementById(`title_${codAF}`).title = s.error
        }
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    });
  }
  function situation(codAF, aux, bank) {
    if (document.getElementById(`situation_${codAF}`).style.color == 'red' || document.getElementById(`situation_${codAF}`).style.color == "green" || document.getElementById(`situation_${codAF}`).style.color == "orange") return;
    $.ajax({ type: "post", url: `http://localhost:3000/propostas/situation`, data: JSON.stringify({
      user: localStorage.getItem('user'), 
      password: localStorage.getItem('password'),
      proposta: codAF,
      bank: bank,
      actual: document.getElementById(`situation_${codAF}`) ? document.getElementById(`situation_${codAF}`).value : false
    }),contentType:"application/json; charset=utf-8",
      success: function(s) {
        if (s.not && !aux) {
          return situation(codAF, aux, bank)
        } else if (s.error) {
          document.getElementById(`situation_${codAF}`).style.color = `red`
          document.getElementById(`situation_${codAF}`).value = s.error
          return document.getElementById(`title_${codAF}`).title = s.error
        } else if (s.end && aux) {
          document.getElementById(`situation_${codAF}`).style.color = `orange`
          document.getElementById(`situation_${codAF}`).value = s.end
          return document.getElementById(`title_${codAF}`).title = s.end
        } else if (!s.end && !s.not) {
          document.getElementById(`situation_${codAF}`).style.color = `blue`
          document.getElementById(`situation_${codAF}`).value = s.result
          document.getElementById(`title_${codAF}`).title = s.result
          return situation(codAF, aux, bank)
        } else if (s.not && !aux) {
          return setTimeout(()=> { return situation(codAF, aux, bank) },3000)
        }
      },
      error: function(e) {
        if (e.error) {
          document.getElementById(`situation_${codAF}`).style.color = `red`
          document.getElementById(`situation_${codAF}`).value = e.error
          return document.getElementById(`title_${codAF}`).title = s.error
        }
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    });
  }

  var changeFaseActive = false
  function changeFase(codAF,fase) {
    if (changeFaseActive) return alert('Você já está alterando a fase de alguma proposta! Aguarde...')
    changeFaseActive = true
    if (menuPropostaActual) menuPropostas(false, menuPropostaActual)
    $.ajax({ type: "post", url: `http://localhost:3000/propostas/changeFase`, data: JSON.stringify({
      user: localStorage.getItem('user'), 
      password: localStorage.getItem('password'),
      proposta: codAF,
      fase: fase,
    }),contentType:"application/json; charset=utf-8",
      success: function(s) {
        changeFaseActive = false
        if (s.error) return alert(s.error)
        alert(`A proposta: ${codAF} teve sua fase alterada com sucesso!`)
      },
      error: function(e) {
        changeFaseActive = false
        if (e.error) return alert(e.error)
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    });
  }

  var changeEsteira = false
  function checkEsteira(codAF) {
    if (changeEsteira) return alert('Você já está alterando a fase de alguma proposta! Aguarde...')
    changeEsteira = true
    if (menuPropostaActual) menuPropostas(false, menuPropostaActual)
    $.ajax({ type: "post", url: `http://localhost:3000/propostas/esteira`, data: JSON.stringify({
      user: localStorage.getItem('user'), 
      password: localStorage.getItem('password'),
      proposta: codAF
    }),contentType:"application/json; charset=utf-8",
      success: function(s) {
        changeEsteira = false
        if (s.error) return alert(s.error)
        return alert(s.data)
      },
      error: function(e) {
        changeEsteira = false
        if (e.error) return alert(e.error)
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    });
  }
  var generatorMenu = false
  function closeGenerator() {
    generatorMenu = false
    document.getElementById('generator').style.display = 'none'
  }

  var generatorCod = false
  function generator(codAF) {
    if (generatorCod || generatorMenu) return alert('Você já está gerando um cadastro! Aguarde...')
    generatorCod = true
    if (menuPropostaActual) menuPropostas(false, menuPropostaActual)
    $.ajax({ type: "post", url: `http://localhost:3000/propostas/generator`, data: JSON.stringify({
      user: localStorage.getItem('user'), 
      password: localStorage.getItem('password'),
      proposta: codAF
    }),contentType:"application/json; charset=utf-8",
      success: function(s) {
        generatorCod = false
        if (s.error) return alert(s.error)
        generatorMenu = true
        document.getElementById('code1').value = s.code1
        document.getElementById('code2').value = s.code2
        document.getElementById('generator').style.display = 'flex'
      },
      error: function(e) {
        generatorCod = false
        if (e.error) return alert(e.error)
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    });
  }

  function copyGenerator(code) {
    if (document.getElementById(code)) {
      if (document.getElementById(code).value) {
        navigator.clipboard.writeText(document.getElementById(code).value);
        return alert('Codigo copiado com sucesso!')
      } else return alert('Não a nada aqui para ser copiado...')
    } else return alert('Não encontrei o codigo...')
  }
</script>
<script>
    function searchBar() {
    var input, filter, ul, li, a, i, txtValue;
    input = document.getElementById('searchBar');
    filter = input.value.toUpperCase();
    ul = document.getElementById("propostas-lista");
    li = ul.getElementsByTagName('proposta');
    for (i = 0; i < li.length; i++) {
      a = li[i]
      txtValue = a.textContent || a.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        li[i].style.display = "inline";
      } else {
        li[i].style.display = "none";
      }
    }
  }
</script>